<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Uploads • Quanna Leap AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="/style.css" />
</head>

<body>
<header class="top-header">
<div class="header-inner">
<h1>Quanna Leap AI</h1>
<span class="status">● Online</span>

<nav>
<a href="/">Home</a>
<a href="/projects.html">Projects</a>
<a href="/uploads.html">Uploads</a>
</nav>
</div>
</header>

<main>
<h2 class="hero-title">Uploads</h2>
<p class="hero-sub">Upload images, then generate your Image → Video request.</p>

<section class="cards">
<div class="card" style="min-width: 320px;">
<h3>Upload Images</h3>
<p>Select multiple images (PNG/JPG). Then click “Generate Video”.</p>

<input
id="i2vFiles"
type="file"
accept="image/*"
multiple
style="margin: 10px 0 12px 0; width: 100%;"
/>

<button class="btn" id="i2vGenerateBtn" type="button">Generate Video</button>

<p id="i2vStatus" style="margin-top:10px; opacity:.9;"></p>

<div id="preview" style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;"></div>
</div>
</section>
</main>

<script>
console.log("✅ uploads.html loaded");

const fileInput = document.getElementById("i2vFiles");
const generateBtn = document.getElementById("i2vGenerateBtn");
const statusEl = document.getElementById("i2vStatus");
const previewEl = document.getElementById("preview");

function clearPreview() {
previewEl.innerHTML = "";
}

function addThumb(file) {
const wrap = document.createElement("div");
wrap.style.width = "84px";
wrap.style.height = "84px";
wrap.style.borderRadius = "12px";
wrap.style.overflow = "hidden";
wrap.style.border = "1px solid rgba(255,255,255,0.12)";

const img = document.createElement("img");
img.style.width = "100%";
img.style.height = "100%";
img.style.objectFit = "cover";

const url = URL.createObjectURL(file);
img.src = url;
img.onload = () => URL.revokeObjectURL(url);

wrap.appendChild(img);
previewEl.appendChild(wrap);
}

fileInput.addEventListener("change", () => {
statusEl.textContent = "";
clearPreview();

const files = Array.from(fileInput.files || []);
if (!files.length) return;

files.slice(0, 12).forEach(addThumb);

if (files.length > 12) {
const more = document.createElement("p");
more.style.marginTop = "10px";
more.style.opacity = ".85";
more.textContent = `Showing 12 previews (you selected ${files.length}).`;
previewEl.appendChild(more);
}
});

generateBtn.addEventListener("click", async () => {
const files = Array.from(fileInput.files || []);
if (!files.length) {
statusEl.textContent = "❌ Please select at least 1 image first.";
return;
}

statusEl.textContent = "Uploading images…";
generateBtn.disabled = true;

try {
const fd = new FormData();

// IMPORTANT: field name must match what your backend expects.
// Most multer configs use upload.array("images")
// so we send "images" here.
files.forEach((f) => fd.append("images", f));

const res = await fetch("/api/image-to-video", {
method: "POST",
body: fd
});

const data = await res.json().catch(() => ({}));

if (!res.ok || !data.ok) {
throw new Error(data.error || "Backend error");
}

// If your backend later returns a video URL, we can display it here.
statusEl.textContent = "✅ Uploaded! Backend received images (video step coming next).";

} catch (err) {
console.error(err);
statusEl.textContent = "❌ " + (err.message || "Error generating video");
} finally {
generateBtn.disabled = false;
}
});
</script>
</body>
</html>
